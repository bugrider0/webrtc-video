const socket = io();
const PC = new window.RTCPeerConnection();

const callUser = async (socketId) => {
  const offer = await PC.createOffer();
  await PC.setLocalDescription(new window.RTCSessionDescription(offer));

  socket.emit("callUser", {
    offer,
    target: socketId,
  });
};

socket.on("updateUsersList", (data) => {
  const usersContainer = document.querySelector(".footer");

  if (data.users.length > 0) {
    data.users.map((userId) => {
      const userExist = document.getElementById(userId);
      if (!userExist) {
        const userContainer = document.createElement("div");
        userContainer.setAttribute("id", userId);
        userContainer.innerHTML = userId;
        usersContainer.appendChild(userContainer);

        userContainer.addEventListener("click", () => {
          userContainer.setAttribute("class", "activeUser");
        });
      }
    });
  }
});

socket.on("removeUser", ({ userId }) => {
  const user = document.getElementById(userId);

  if (user) {
    user.remove();
  }
});

navigator.getUserMedia(
  // Premissions
  { video: true, audio: true },

  // IF(Resolve)
  (stream) => {
    const localVideo = document.getElementById("local-video");

    // Pass to 'Video' Tag
    if (localVideo) {
      localVideo.srcObject = stream;
    }
  },

  // IF(Reject)
  (err) => {
    console.log(err.message);
  }
);
